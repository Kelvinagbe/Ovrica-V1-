const C=require('./0x744.json');class U{constructor(o,h){this.o=o;this.h=h;this.l=C.x2c;this.p=C.x3d}async g(u){const c=this.h.g(u,this.p);if(c){console.log(`${C.x4e} User '${u}' cached`);return c}try{const d=await this.o.v(),l=d.collection(this.l),r=await l.findOne({userId:u});if(r)this.h.s(u,r,this.p);return r}catch(e){console.error(`${C.x4c} Get user '${u}':`,e.message);throw e}}async s(u,data){try{const d=await this.o.v(),l=d.collection(this.l),up={...data,userId:u,lastActive:new Date()};await l.updateOne({userId:u},{$set:up},{upsert:!0});this.h.s(u,up,this.p);console.log(`${C.x4a} User '${u}' saved`);return!0}catch(e){console.error(`${C.x4c} Save user '${u}':`,e.message);throw e}}async d(u){try{const d=await this.o.v(),l=d.collection(this.l),r=await l.deleteOne({userId:u});if(r.deletedCount>0){this.h.d(u,this.p);console.log(`${C.x4a} User '${u}' deleted`);return!0}return!1}catch(e){console.error(`${C.x4c} Delete user '${u}':`,e.message);throw e}}async l(f={}){try{const d=await this.o.v(),l=d.collection(this.l);return await l.find(f).toArray()}catch(e){console.error(`${C.x4c} List users:`,e.message);throw e}}async a(u){try{const d=await this.o.v(),l=d.collection(this.l);await l.updateOne({userId:u},{$set:{lastActive:new Date()}},{upsert:!0});return!0}catch(e){console.error(`${C.x4c} Update activity '${u}':`,e.message);throw e}}}module.exports=U;